<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Past Livestream Events ‚Äì SMHS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 2rem;
      color: #333;
    }
    h1, h2 { text-align: center; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 2rem;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th { background: #0077cc; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    a { color: #0077cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .event-block { margin-bottom: 3rem; }
    .archive-date {
      text-align: center;
      color: #666;
      font-size: 0.9rem;
      margin-top: -0.5rem;
      margin-bottom: 1rem;
    }
    .controls {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    select {
      padding: 8px;
      margin: 0 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    #searchInput {
  padding: 8px;
  width: 220px;
  border: 1px solid #aaa;
  border-radius: 5px;
}

  </style>
</head>
<body>
  <h1><a href="#top">√âcole St. Mary High School ‚Äì Past Livestream Events</a></h1>
  <h4 align="center"><a href="index.html">üì∫ View current event</a></h4>
<p align="center"><b>‚ÑπÔ∏è Tip:</b> If you are using on a mobile deviceüì±, zoom out üîç to see the entire tables.</p>
  <!-- FILTERS + SORTING -->
  <div class="controls">
    <br>
<label for="searchInput"><b>Search:</b></label>
<input type="text" id="searchInput" placeholder="Type to search‚Ä¶">
    <label for="sortSelect"><b>Sort events by:</b></label>
    <select id="sortSelect">
      <option value="day1newest">Day 1 ‚Äì Newest first</option>
      <option value="day1oldest">Day 1 ‚Äì Oldest first</option>
      <option value="alphabetical">Alphabetical order</option>
    </select>

    <label for="filterSelect"><b>Refine by sport/event type:</b></label>
    <select id="filterSelect">
      <option value="all">All</option>
      <option value="volleyball">Volleyball</option>
      <option value="basketball">Basketball</option>
      <option value="soccer">Soccer</option>
      <option value="wrestling">Wrestling</option>
      <option value="concert">Concert</option>
      <option value="model un">Model UN</option>
      <option value="award">Award Ceremony</option>
      <option value="grad">Graduation Ceremonies</option>

    </select>

    <label for="filterGender"><b>Gender:</b></label>
    <select id="filterGender">
      <option value="all">All</option>
      <option value="boys">Boys</option>
      <option value="girls">Girls</option>
    </select>

    <label for="filterLevel"><b>Level:</b></label>
    <select id="filterLevel">
      <option value="all">All</option>
      <option value="junior">Junior</option>
      <option value="senior">Senior</option>
    </select>

    <label for="filterYear"><b>Year:</b></label>
    <select id="filterYear">
      <option value="all">All</option>
      <option value="2026">2026</option>
      <option value="2025">2025</option>
      <option value="2024">2024</option>
      <option value="2023">2023</option>
    </select>
  </div>

  <div id="eventsContainer" align="center">Loading past events...</div>

  <script>
  const jsonUrl =
    "https://raw.githubusercontent.com/smhslivestream/event-links/main/liens.json?nocache=" +
    Date.now();

  let pastEvents = [];

  // Fetch JSON
  fetch(jsonUrl)
    .then((response) => {
      if (!response.ok) throw new Error("Network response was not ok");
      return response.json();
    })
    .then((data) => {
      if (!data || !Array.isArray(data.events)) {
        document.getElementById("eventsContainer").textContent =
          "‚ö†Ô∏è Invalid JSON structure.";
        return;
      }

      // NEW: Only events where current === false
      pastEvents = data.events.filter((ev) => ev.current === false);

      renderEvents();
    })
    .catch((error) => {
      console.error("Error loading JSON:", error);
      document.getElementById("eventsContainer").textContent =
        "‚ö†Ô∏è Failed to load past events.";
    });

function formatISODate(dateStr) {
  // Expected: YYYY-MM-DD
  if (!/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) return dateStr;

  const [year, month, day] = dateStr.split("-");
  const date = new Date(year, month - 1, day);

  const weekday = date.toLocaleDateString("en-US", { weekday: "long" });
  const monthAbr = date.toLocaleDateString("en-US", { month: "short" });

  return `${weekday}, ${monthAbr}. ${day}, ${year}`;
}

function detectEventType(title) {
  if (!title) return "Other";
  const t = title.toLowerCase();

  if (t.includes("grad")) return "Grad";
  if (t.includes("award")) return "Awards";
  if (t.includes("concert")) return "Concert";
  if (t.includes("basketball")) return "Basketball";
  if (t.includes("volleyball")) return "Volleyball";
  if (t.includes("soccer")) return "Soccer";
  if (t.includes("wrestling")) return "Wrestling";
  if (t.includes("model un") || t.includes("mun")) return "Model UN";

  return "Other";
}

function getEventCategory(title) {
  if (!title) return { name: "Other", color: "#888", textColor: "white" };
  const t = title.toLowerCase();

  // SPORTS (Blue)
  if (t.includes("volleyball") || t.includes("basketball") || t.includes("soccer") || t.includes("wrestling")) {
    return { name: "Sports", color: "#0077cc", textColor: "white" };
  }

  // ARTS (Red)
  if (t.includes("concert") || t.includes("music") || t.includes("choir") || t.includes("band")) {
    return { name: "Arts", color: "#cc0000", textColor: "white" };
  }

  // ACADEMIC (Green)
  if (t.includes("award") || t.includes("grad") || t.includes("graduation") || t.includes("ceremony")) {
    return { name: "Academic", color: "#22aa22", textColor: "white" };
  }

  // MODEL UN (White)
  if (t.includes("model un") || t.includes("mun") || t.includes("debate")) {
    return { name: "Model UN", color: "white", textColor: "black", border: "2px solid #000" };
  }

  return { name: "Other", color: "#777", textColor: "white" };
}
    
  function renderEvents() {
    const container = document.getElementById("eventsContainer");
    container.innerHTML = "";

    const sortBy = document.getElementById("sortSelect").value;
    const sportFilter = document.getElementById("filterSelect").value;
    const genderFilter = document.getElementById("filterGender").value;
    const levelFilter = document.getElementById("filterLevel").value;
    const yearFilter = document.getElementById("filterYear").value;
    const searchTerm = document.getElementById("searchInput").value.toLowerCase();

    // FILTERS
    let filteredEvents = pastEvents.filter((ev) => {
      const title = (ev.event_title || "").toLowerCase();

      if (sportFilter !== "all" && !title.includes(sportFilter)) return false;
      if (genderFilter !== "all" && !title.includes(genderFilter)) return false;
      if (levelFilter !== "all" && !title.includes(levelFilter)) return false;

      if (yearFilter !== "all") {
        const firstDay = ev.days?.[0];
        const eventYear = firstDay ? new Date(firstDay.date).getFullYear() : null;
        if (eventYear && eventYear.toString() !== yearFilter) return false;
      }
      if (searchTerm !== "" && !title.includes(searchTerm)) return false;
      return true;
    });

    // SORTING
    const getDay1Date = (ev) =>
      ev.days?.[0] ? new Date(ev.days[0].date) : new Date(0);

    filteredEvents.sort((a, b) => {
      if (sortBy === "alphabetical") {
        return (a.event_title || "").localeCompare(b.event_title || "");
      }
      if (sortBy === "day1newest") {
        return getDay1Date(b) - getDay1Date(a);
      }
      if (sortBy === "day1oldest") {
        return getDay1Date(a) - getDay1Date(b);
      }
      return 0;
    });

    // NO RESULTS
    if (filteredEvents.length === 0) {
      container.innerHTML = "<p>No events found for this selection.</p>";
      return;
    }

    // RENDER EACH EVENT
    filteredEvents.forEach((event) => {
      const block = document.createElement("div");
      block.className = "event-block";

      // TITLE
const title = document.createElement("h2");
title.textContent = event.event_title || "Untitled Event";

// Category badge
const category = getEventCategory(event.event_title);

const badge = document.createElement("span");
badge.textContent = category.name;
badge.style.background = category.color;
badge.style.color = category.textColor;
badge.style.padding = "4px 10px";
badge.style.borderRadius = "12px";
badge.style.fontSize = "0.85rem";
badge.style.marginLeft = "10px";
badge.style.display = "inline-block";
badge.style.verticalAlign = "middle";
if (category.border) badge.style.border = category.border;

title.appendChild(badge);

block.appendChild(title);

      // TABLE GENERATION
      let tableHTML = "<table><thead><tr><th>Date</th>";

      // Build dynamic court list across ALL days
      const courtNames = [
        ...new Set((event.days || []).flatMap((day) => Object.keys(day.links || {}))),
      ];

      courtNames.forEach((court) => (tableHTML += `<th>${court}</th>`));
      tableHTML += "</tr></thead><tbody>";

      (event.days || []).forEach((day) => {
        let displayDate = "-";
        
        if (day.date) {
        displayDate = formatISODate(day.date);
        } else if (day.label) {
        displayDate = day.label;
        }

        tableHTML += `<tr><td>${displayDate}</td>`;

        courtNames.forEach((court) => {
          const link = day.links?.[court] || null;
          if (link && link.startsWith("http")) {
            tableHTML += `<td><a href="${link}" target="_blank">${link}</a></td>`;
          } else {
            tableHTML += `<td>${link || "-"}</td>`;
          }
        });

        tableHTML += "</tr>";
      });

      tableHTML += "</tbody></table>";

      block.appendChild(title);
      block.insertAdjacentHTML("beforeend", tableHTML);

      container.appendChild(block);
    });
  }

  // All filters re-render the list
  ["sortSelect", "filterSelect", "filterGender", "filterLevel", "filterYear"].forEach((id) =>
    document.getElementById(id).addEventListener("change", renderEvents);
    document.getElementById("searchInput").addEventListener("input", renderEvents);

  );
</script>


  <h4 align="center">
    <a href="index.html">üì∫ View current event</a> - 
    <a href="#top">üîù Back to top</a>
  </h4>
  <h5 align="center">
    <b>Livestream links provided by <i>√âcole St. Mary High School A/V & Livestreaming Crew.</i></b>
  </h5>
</body>
</html>
