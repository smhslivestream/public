<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Current Livestream Event</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 2rem;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    th {
      background: #0077cc;
      color: white;
    }
    tr:nth-child(even) {
      background: #f2f2f2;
    }
    a {
      color: #0077cc;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 6px;
      background: #0077cc;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #005fa3;
    }
  </style>
</head>
<body>
  <h1>√âcole St. Mary High School Livestreaming Page</h1>
  
  <h2 id="eventTitle">Loading event...</h2>
  <div id="tableContainer"></div>

  <p align="center">
    <button id="copyTableBtnF">üìã Copy Current Event (Formatted)</button>
    <button id="copyTableBtn">üìÑ Copy Current Event (Plain Text)</button>
  </p>

  <script>
  const jsonUrl =
    "https://raw.githubusercontent.com/smhslivestream/event-links/main/liens.json?nocache=" +
    Date.now();

  fetch(jsonUrl)
    .then(response => {
      if (!response.ok) throw new Error("Network response was not ok");
      return response.json();
    })
    .then(data => {
      // NEW JSON STRUCTURE:
      // {
      //   "updated_at": "2025-11-21T04:48:44Z",
      //   "events": [
      //      { event_title, current, days: [...] }, ...
      //   ]
      // }

      const titleEl = document.getElementById("eventTitle");
      const container = document.getElementById("tableContainer");

      if (!data || !Array.isArray(data.events)) {
        titleEl.textContent = "‚ö†Ô∏è Invalid JSON format.";
        return;
      }

      // ---- FIND THE CURRENT EVENT ----
      const event = data.events.find(evt => evt.current === true);

      if (!event) {
        titleEl.textContent = "No current event found.";
        return;
      }

      titleEl.textContent = event.event_title || "Current Event";

      if (!event.days || event.days.length === 0) {
        container.innerHTML = "<p>No days available for this event.</p>";
        return;
      }

      // ---- TABLE HEADER: all courts used across all days ----
      const courtNames = [...new Set(event.days.flatMap(day => Object.keys(day.links || {})))];

      let tableHTML = "<table><thead><tr><th>Date</th>";
      courtNames.forEach(court => (tableHTML += `<th>${court}</th>`));
      tableHTML += "</tr></thead><tbody>";

      // ---- TABLE ROWS PER DAY ----
      event.days.forEach(day => {
        tableHTML += `<tr><td>${day.label || day.date || "-"}</td>`;

        courtNames.forEach(court => {
          const link = day.links ? day.links[court] : null;

          if (link && link.startsWith("http")) {
            tableHTML += `<td><a href="${link}" target="_blank">${link}</a></td>`;
          } else {
            tableHTML += `<td>${link || "-"}</td>`;
          }
        });

        tableHTML += "</tr>";
      });

      tableHTML += "</tbody></table>";
      container.innerHTML = tableHTML;
    })
    .catch(error => {
      console.error("Error loading JSON:", error);
      document.getElementById("eventTitle").textContent = "‚ö†Ô∏è Failed to load event data.";
    });

  // --- Copy as Plain Text ---
  document.getElementById("copyTableBtn").addEventListener("click", function () {
    const titleElement = document.querySelector("#eventTitle");
    const table = document.querySelector("table");

    if (!titleElement || !table) {
      alert("No event found!");
      return;
    }

    let text = titleElement.innerText + "\n\n";
    for (let row of table.rows) {
      const cells = Array.from(row.cells).map(cell => cell.innerText.trim());
      text += cells.join("\t") + "\n";
    }

    navigator.clipboard
      .writeText(text)
      .then(() => alert("‚úÖ Event and table copied as plain text!"))
      .catch(() => alert("‚ö†Ô∏è Failed to copy automatically."));
  });

  // --- Copy as Formatted (HTML) ---
  document.getElementById("copyTableBtnF").addEventListener("click", function () {
    const titleElement = document.querySelector("#eventTitle");
    const table = document.querySelector("table");

    if (!titleElement || !table) {
      alert("No event found!");
      return;
    }

    const tempDiv = document.createElement("div");
    tempDiv.innerHTML = `<h2>${titleElement.innerText}</h2>` + table.outerHTML;
    document.body.appendChild(tempDiv);

    const range = document.createRange();
    range.selectNode(tempDiv);
    const selection = window.getSelection();
    selection.removeAllRanges();
    selection.addRange(range);

    try {
      document.execCommand("copy");
      alert("‚úÖ Event and table copied with formatting!");
    } catch (err) {
      alert("‚ö†Ô∏è Unable to copy automatically. Please select and copy manually.");
    }

    selection.removeAllRanges();
    tempDiv.remove();
  });
</script>


  <h4 align="center"><a href="past.html">üóÑÔ∏è View past events</a></h4>
  <h5 align="center"><b>Livestream links provided by <i>√âcole St. Mary High School A/V & Livestreaming Crew.</i></b></h5>
  <h6 align="center">Version 1.3</h6>
<!-- FOLLOW US ON INSTAGRAM -->
<div style="text-align:center; margin-top:2rem; padding-top:1.5rem; border-top:1px solid #ddd;">
  <a href="https://www.instagram.com/smhs_livestream/" target="_blank" 
     style="display:inline-flex; align-items:center; gap:10px; text-decoration:none; color:#333; font-family:Arial, sans-serif;">
    <!-- Instagram SVG Logo -->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="28" height="28" fill="#E1306C">
      <path d="M349.33 69.33h-186.7A93.67 93.67 0 0 0 69 163v186a93.67 93.67 0 0 0 93.67 93.67h186.66A93.67 93.67 0 0 0 443 349.33V163A93.67 93.67 0 0 0 349.33 69.33Zm61.34 280a61.35 61.35 0 0 1-61.34 61.34h-186.7a61.35 61.35 0 0 1-61.34-61.34v-186.7a61.35 61.35 0 0 1 61.34-61.34h186.66a61.35 61.35 0 0 1 61.34 61.34Z"/>
      <path d="M256 164.1A91.9 91.9 0 1 0 347.9 256 91.91 91.91 0 0 0 256 164.1Zm0 151.42A59.52 59.52 0 1 1 315.52 256 59.52 59.52 0 0 1 256 315.52Z"/>
      <circle cx="365.44" cy="146.56" r="20.44"/>
    </svg>
    <span style="font-size:1.1rem;"><b>Follow us on Instagram</b><br>@smhs_livestream</span>
  </a>
</div>


</body>
</html>
